@{
	ViewData["Title"] = "Admin";
}

<div id="message">
	@if (TempData["message"] != null && TempData["message"].ToString().Length > 0)
	{
		<div class="alert @TempData["messageType"]">
			@TempData["message"]
			<button class="btn-close" onclick="document.getElementById('message').innerHTML=''"></button>
		</div>
	}
</div>

<script>
	function deleteJob(id) {
		if (confirm("Are you sure you want to delete?")) {
			location.href = "Delete?id=" + id;
		}
	}
</script>
<a href="/Admin/AddJob" class="btn btn-primary">Add Job</a>

<table class="table">
	<thead>
		<tr>
			<th>ID</th>
			<th>Name</th>
			<th>Category</th>
			<th>Sub-category</th>
			<th>Salary</th>
			<th>Deadline</th>
			<th>Edit</th>
			<th>Delete</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var job in (List<JobModel>)ViewBag.jobs)
		{
			@if (ViewBag.editID != null && ViewBag.editID == job.Id)
{
    <form method="post" action="Edit">
    <tr>
        <td><input type="hidden" name="id" value="@job.Id" />@job.Id</td>
        <td><input name="name" value="@job.Name"></td>
        <td>
						<select class="form-control" name="category" id="category" required>
							<option value="@job.Category" selected disabled>@job.Category</option>
							<option value="IT">IT</option>
							<option value="Outreach">Outreach</option>
						</select>
					</td>
        <td>
                        <select class="form-control" name="subcategory" id="subcategory" required>
							<option value="@job.SubCategory" selected disabled>@job.SubCategory</option>
                        </select>
                    </td>
        <td><input name="salary" value="@job.Salary"></td>
        <td><input type="date" name="deadline" value="@job.DeadLine.ToString("yyyy-MM-dd")"></td>
        <td><button class="btn btn-primary" type="submit">Update</button></td>
        <td><a class="btn btn-danger" href="Admin">Cancel</a></td>
    </tr>
    </form>


				<script>
					var categoryObject = {
						"IT": ["Dev", "Testing", "UI/UX"],
						"Outreach": ["Promotion", "Graphic Design"]
					};

					var categorySel = document.getElementById("category");
					var subcategorySel = document.getElementById("subcategory");

					categorySel.onchange = function () {
						// empty sub-category dropdown
						subcategorySel.length = 1;
						// display correct values
						var z = categoryObject[this.value];
						for (var i = 0; i < z.length; i++) {
							subcategorySel.options[subcategorySel.options.length] = new Option(z[i], z[i]);
						}
					}
				</script>
			}

			else
			{
				<tr>
					<td>@job.Id</td>
					<td>@job.Name</td>
					<td>@job.Category</td>
					<td>@job.SubCategory</td>
					<td>@job.Salary</td>
					<td>@job.DeadLine.ToString("yyyy-dd-MM")</td>
					<td><a class="btn btn-primary" href="Admin?editid=@job.Id">Edit</a></td>
					<td><button class="btn btn-danger" onclick="deleteJob(@job.Id)">Delete</button></td>
				</tr>
			}
		}
	</tbody>
</table>
